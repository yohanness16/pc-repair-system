<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Repair History - {{ equipment.tag_number }}</title>
    <style>
        body { font-family: Arial, sans-serif; font-size: 12px; }
        h2 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; }
        .signature { margin-top: 50px; width: 100%; display: flex; justify-content: space-between; }
        .signature div { width: 40%; text-align: center; }
        .signature-line { border-top: 1px solid #000; margin-top: 50px; }
    </style>
</head>
<body>
    <h2>Repair History for Equipment #{{ equipment.tag_number }}</h2>
    <p><strong>Serial Number:</strong> {{ equipment.serial_number }}</p>
    <p><strong>Category:</strong> {{ equipment.item_category }}</p>
    <p><strong>Branch:</strong> {{ equipment.branch.name }}</p>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Status</th>
                <th>Report</th>
                <th>Remark</th>
                <th>Completed At</th>
                <th>Repair Staff</th>
                <th>Parts Used</th>
            </tr>
        </thead>
        <tbody>
            {% for repair in repairs %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ repair.status }}</td>
                <td>{{ repair.report|default:"-" }}</td>
                <td>{{ repair.remark|default:"-" }}</td>
                <td>{{ repair.completed_at|date:"Y-m-d H:i" }}</td>
                <td>
                    {% if repair.repair_staff %}
                        {{ repair.repair_staff.first_name }} {{ repair.repair_staff.last_name }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% for part in repair.repair_parts.all %}
                        {{ part.part.name }} (x{{ part.quantity }}){% if not forloop.last %}, {% endif %}
                    {% empty %}
                        -
                    {% endfor %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" style="text-align:center;">No completed repairs.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="signature">
        <div>
            <div class="signature-line"></div>
            <p>Repair Staff Signature</p>
        </div>
        <div>
            <div class="signature-line"></div>
            <p>Admin Signature</p>
        </div>
    </div>
</body>
</html>
